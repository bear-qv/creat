var url = require('url');
var querystring = require('querystring');

//req解析处理器
var reqdo = function(req){
  //->简单方法的集成
  //初始化
  req.getarr={};
  req.postarr={};
  req.files={};
  //ip的解析
  req.ip = req.connection.remoteAddress;
  //get-header的方法
  req.get = function(n){
    n = n.toLowerCase();
    return req.headers[n];
  };
  //cookie解析
  req.cookie = cookieparser(req.get('cookie'));
  //url解析
  req = urlparser(req);
  return req;
}

//->从属函数部分

function urlparser(req){
  req.urlinfo = url.parse(req.url);
  req.path = req.urlinfo.pathinfo;
  req.getarr = querystring.parse(req.urlinfo.query);
  return req;
};

function cookieparser(v){
  var rest = {};
  if(v){
    rest = querystring.parse(v,'; ','=');
  };
  return rest;
};
exports = module.exports = reqdo;